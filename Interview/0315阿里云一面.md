## 项目
疯狂追问深挖，对项目细节一定要了如指掌，描述要简明清晰，另外，还要有对**项目深度**的思考。我自己项目没复习好，表达能力也堪忧，所以这块答得很烂。
 1. TCP项目性能瓶颈怎么突破的？  
    答：项目的最低要求是100Mbit/s，虽然第一个版本可以达到1.0Gbit/s左右，但是官方说自己的吞吐量可以达到1.7Gbit/s，所以为了提升性能，要利用CSAPP中的性能优化相关知识挑战。  
    首先，profiling寻找性能瓶颈。修改编译参数，将-g改为-Og -pg，使得生成程序可以用gprof进行剖析；将对benchmark的分析结果重定向到文本，观察耗时操作；  
    其次，发现了ByteStream的write/pop/peek操作占据了大概80%的时间，string通过push_back写入的，存储方式是基于内存拷贝的，比较慢；  
    因此，希望将buffer的对象的存储方式改为基于内存所有权转移，通过move调用移动构造函数，避免对string深拷贝，从而提升性能。
 2. 怎么转移？move怎么转移的？  
    答：移动构造函数的参数是右值引用即只接受右值，`move`是将左值强制转换为右值，让右值引用可以指向。等同于`static_cast<T&&>(lvalue)`
 3. 项目怎么测试的？  
    答：通过构造一些小case，打断点观察相应变量的变化
 4. GDB常见命令
    ```
    gcc main.c -Og main.exe 生成调试信息，-Og介于O0和O1之间，在保持快速编译和良好调试体验的同时，提供较为合理的优化级别
    gdb main.exe
    break linenum  // 源代码某行打断点
    run  // 执行程序直到第一个断点
    continue  // 继续执行直到下一个断点或程序结束
    next  // 逐行执行
    print variable  // 打印变量值
    list  // 显示源代码的内容
    quit 
    ```
 5. web项目HTTP头部格式  
   HTTP请求报文组成：  
   请求行：请求方法 URL 协议版本\r\n  
若干行请求头部：头部字段名:值\r\n 包括host user-agent connection  
   \r\n  
   请求数据
 6. 项目怎么解析URL的  
   解析请求行获得域名和端口  
   请求头部原封不动转发，缺少的头部用默认值填充
 7. 别人调用的流程是什么
   
 8. malloc项目别人调用会发生什么？
    1. 检查申请的size是否小于等于0；
    2. 调整size大小使其满足8B对齐要求；
    3. 在已有的分级链表中查找合适的链表，在该链表中寻找满足大小的块进行分配，返回指针；
    4. 如果已有分级链表中没有满足要求的块，向虚拟堆申请更大的内存，申请失败返回null，否则放置该块。
    所有的放置过程：如果剩余空闲容量小于16B就全部分配，如果要求的size>=112B，从后面划分，否则从前面划分，将剩余空闲容量重新插入空闲链表。  
    为什么这样做可以提高性能？因为测试样例有小大小大的情况，如果都是从头分配，那么如果free时只释放大的，就会造成很多内存外碎片，不连续所以不能合并，下次申请大的就寄了。  
    如果按照我们的方法，大的内存块释放时可以合并，下次申请大的就ok，提高内存利用率。
 9. 为什么你的实现比别人快？TCMalloc实现和Glibc malloc实现
    搜索时间只花费在特定的链表上而非整个堆，内存利用率近似于最佳匹配  
    glibc使用的是ptmalloc2 tcmalloc是谷歌的 jemalloc是fb的
 11. 链表怎么实现的？
    相比于隐式链表，现在每块都有prev和next指针，降低了分配的时间复杂度。原来是O(N)，现在是O(free)
   
## 计网
 1. 3次握手
 2. TCP如果只握手2次有什么安全隐患？  
   攻击者截取服务器回复的SYN和ACK，伪装成原主机继续通信
 4. 客户端发送SYN包后不管了咋办？
   服务器超时重传，达到最大次数后发RST并关闭连接
 6. SYN泛洪攻击
 7. TCP频繁短连接会有什么问题  
   客户端处于time_wait状态，同时源端口不可用，端口号很快耗尽
   
## 算法题
剑指32变种 交替打印二叉树
   ```cpp
   void print(TreeNode* root, vector<int>& output) {}
   ```
   注意从左向右时可以直接加到output，反之反向遍历tmp加到output

   10亿个IP地址快速查找某个是否出现？不能用哈希表和外存？bitmap?原理？把IP转为unsigned int，用bitset
   
## 语言
 1. volatile干嘛用的？什么原理？  
   编译器对访问该变量的代码不再优化，提供对特殊地址的稳定访问。总是重新从内存读取数据，即使前面的指令刚刚从该内存地址读取过
   ```cpp
   volatile int i = 10;
   int a = i;
   int b = i;
   ```
   多任务间每个任务共享的标志应该[加volatile](https://zhuanlan.zhihu.com/p/62060524)  
 2. 虚函数实现原理？构造函数为虚函数？构造函数中定义虚函数？  
    构造函数不能为虚  
    可以在构造函数调用虚函数，无法[实现多态](https://www.zhihu.com/question/35632207)  
 3. [vector的push_back过程](https://zhuanlan.zhihu.com/p/377186496)  
 4. `map` `unordered_map` `multimap`实现原理
    
## OS
 1. 线程安全概念  
   多线程访问某个方法，不论线程的执行顺序如何，都无需在主程序同步，最终的结果都是我们期望的，该方法线程安全
 2. 举一个线程不安全的例子  
   我举了计数器  
   [如何写出线程不安全的代码](https://zhuanlan.zhihu.com/p/32531445)
 3. 除了加锁还有什么解决方法  
   使用原子操作，加锁同步；可重入代码，thread-local存储，不可变对象，用volatile等避免过度优化  
   [Thread safety](https://en.wikipedia.org/wiki/Thread_safety), [确保线程安全的几种方法](https://developer.aliyun.com/article/254282)
